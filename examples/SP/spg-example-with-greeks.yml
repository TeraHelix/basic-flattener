
name: SP Global Flattening
inputPath: HNB_Fixed.xml

outputTables:

  - name: trade-rows

    outputFile: output/trade-rows.csv
    definition:

      - columnName: ReportName
        sourceType: xpath
        sourceDef: ReportResponse/ReportStatus/@reportName

      - columnName: AsOfDate
        sourceType: xpath
        sourceDef: ReportResponse/MarkToMarketReport/@asOfDate

      - columnName: Currency
        sourceType: xpath
        sourceDef: ReportResponse/MarkToMarketReport/@currency

      - columnName: TradeRow
        sourceType: xpath
        sourceDef: ReportResponse/MarkToMarketReport/TradeRow
        explode: true

        repeatingList:
          - columnName: tradeId
            sourceType: xpath
            sourceDef: "@tradeId"

          - columnName: groupId
            sourceType: xpath
            sourceDef: "@groupId"

          - columnName: book
            sourceType: xpath
            sourceDef: "@book"

          - columnName: tradeType
            sourceType: xpath
            sourceDef: "@tradeType"

          - columnName: tradeDate
            sourceType: xpath
            sourceDef: "@tradeDate"

          - columnName: marketPrice
            sourceType: xpath
            sourceDef: "@marketPrice"

          - columnName: underlying
            sourceType: xpath
            sourceDef: "@underlying"

          - columnName: units
            sourceType: xpath
            sourceDef: "@units"

          - columnName: type
            sourceType: xpath
            sourceDef: "@type"

          - columnName: Calendar
            sourceType: xpath
            sourceDef: "@calendar"

  - name: greek-rows
    outputFile: output/greek-rows.csv
    definition:

      - columnName: ReportName
        sourceType: xpath
        sourceDef: ReportResponse/ReportStatus/@reportName

      - columnName: TradeRow
        sourceType: xpath
        sourceDef: ReportResponse/MarkToMarketReport/TradeRow
        explode: true

        repeatingList:
          - columnName: tradeId
            sourceType: xpath
            sourceDef: "@tradeId"

          - columnName: groupId
            sourceType: xpath
            sourceDef: "@groupId"

          - columnName: book
            sourceType: xpath
            sourceDef: "@book"

          - columnName: GreeksByUnderlying
            sourceType: xpath
            sourceDef: Greeks/GreeksByUnderlying
            explode: true
            repeatingList:
              - columnName: underlying
                sourceType: xpath
                sourceDef: "@underlying"

              - columnName: delta
                sourceType: xpath
                sourceDef: "@delta"
